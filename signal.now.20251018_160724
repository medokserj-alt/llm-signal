#!/usr/bin/env bash
set -euo pipefail

cd "$(dirname "$0")"
mkdir -p logs

ts=$(date -u +%Y%m%d_%H%M%S)
run_log="logs/signal_${ts}.log"
last_json="logs/last.json"

# Основная логика — та же, просто пишем stdout в лог
{
  python3 get_signal_json.py "$@" &&
  python3 extract_json.py < analysis.out > "$last_json" &&
  python3 save_analysis_text.py < analysis.out &&
  python3 render_strict.py "$last_json" > "signal_${ts}.html" &&
  python3 logical_check.py "$last_json" || true
} 2>&1 | tee "$run_log"

echo "----------------------------------------"
echo "✅ Saved logs: $run_log"
echo "✅ Last JSON:  $last_json"
